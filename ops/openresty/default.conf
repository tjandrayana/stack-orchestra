server {
    listen 80;
    server_name _;

    # Enable Lua
    location / {
        default_type text/html;
        content_by_lua_block {
            ngx.say("<h1>Stack Orchestra - OpenResty</h1>")
            ngx.say("<p>OpenResty with Lua support is running!</p>")
            ngx.say("<p>Server time: ", ngx.localtime(), "</p>")
            ngx.say("<p>Request URI: ", ngx.var.request_uri, "</p>")
        }
    }

    # Example: Lua script from file
    location /lua {
        default_type text/html;
        content_by_lua_file /usr/local/openresty/nginx/lua/hello.lua;
    }

    # Example: API endpoint with JSON response
    location /api/info {
        default_type application/json;
        content_by_lua_block {
            local cjson = require "cjson"
            local info = {
                service = "openresty",
                version = "1.25.3.1",
                lua_version = _VERSION,
                timestamp = ngx.time(),
                request_method = ngx.var.request_method,
                remote_addr = ngx.var.remote_addr
            }
            ngx.say(cjson.encode(info))
        }
    }

    # Health check endpoint
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}

